{"version":3,"sources":["webpack:///./src/views/category/Category.vue?6955","webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?9df4"],"names":["id","class","default","active","tabClick","title","activeKey","activeNames","accordion","categories","item","key","name","children","sub","getGoods","showGoods","itemClick","num","sales","tag","comments_count","price","desc","updated_at","thumb","cover_url","lazy-load","bTop","isShowBackTop","getCategory","request","url","getCategoryGoods","order","cid","page","setup","router","bscroll","currentOrder","currentCid","goods","list","value","init","then","res","data","document","querySelector","prodeType","click","pullUpLoad","on","position","y","push","finishPullUp","refresh","console","log","index","orders","scrollTo","path","query","components","NavBar","BackTop","render","__scopeId"],"mappings":"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","file":"js/chunk-615c389e.bc067383.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=7d627974&scoped=true&lang=scss\"","<template>\r\n<div>\r\n    <NavBar>\r\n    <template v-slot:default>商品分类</template>\r\n    </NavBar>\r\n    <div id=\"mainbox\">\r\n      <div class=\"ordertab\">\r\n        <!--vant标签页组件-->\r\n        <van-tabs v-model=\"active\" @click=\"tabClick\">\r\n          <van-tab title=\"销量排序\"></van-tab>\r\n          <van-tab title=\"价格排序\"></van-tab>\r\n          <van-tab title=\"评论排序\"></van-tab>\r\n        </van-tabs>\r\n      </div>\r\n      <div>\r\n        <!-- 通过vant组件库中 侧边导航 + 折叠面板实现了需要的UI效果-->\r\n\r\n        <van-sidebar class=\"leftmenu\" v-model=\"activeKey\">\r\n          <van-collapse v-model=\"activeNames\" accordion>\r\n            <van-collapse-item v-for=\"item in categories\" :key=\"item.id + item.name\" :title=\"item.name\" :name=\"item.name\">\r\n              <van-sidebar-item\r\n                  v-for=\"sub in item.children\"\r\n                  :key=\"sub.id\"\r\n                  :title=\"sub.name\"\r\n                  @click=\"getGoods(sub.id)\"/>\r\n            </van-collapse-item>\r\n          </van-collapse>\r\n\r\n        </van-sidebar>\r\n      </div>\r\n      <div class=\"goodslist\">\r\n        <div class=\"content\">\r\n          <van-card\r\n              v-for=\"item in showGoods\" :key=\"item.id\"\r\n              @click=\"itemClick(item.id)\"\r\n              :num=\"item.sales\"\r\n              :tag=\"item.comments_count >= 2 ? '畅销' : '一般'\"\r\n              :price=\"item.price\"\r\n              :desc=\"item.updated_at\"\r\n              :title=\"item.title\"\r\n              :thumb=\"item.cover_url\"\r\n              :lazy-load=\"true\"\r\n\r\n          />\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  <BackTop @bTop=\"bTop\"  v-show=\"isShowBackTop\"></BackTop>\r\n</div>\r\n</template>\r\n<script>\r\nimport NavBar from 'components/common/navbar/NavBar.vue';\r\nimport BackTop from 'components/common/backtop/BackTop.vue';\r\nimport { getCategory , getCategoryGoods } from \"network/category.js\";\r\nimport {ref, reactive, onMounted, computed, watchEffect, nextTick} from \"vue\";\r\nimport { useRouter } from 'vue-router';\r\nimport BScroll from 'better-scroll';\r\n\r\nexport default {\r\n    name:\"Category\",\r\n    setup(){\r\n      const router = useRouter();\r\n      let activeKey = ref(0);\r\n      let activeNames = ref(1);\r\n      let categories = ref([]);\r\n      let bscroll = reactive({});\r\n      let active = ref(1);\r\n      let isShowBackTop = ref(false);\r\n      //记录当前排序条件\r\n      let currentOrder = ref('sales');\r\n      //记录当前分类ID\r\n      let currentCid = ref(0);\r\n      //数据模型\r\n      const goods = reactive({\r\n        sales:{page:1,list:[]},\r\n        price:{page:1,list:[]},\r\n        comments_count:{page:1,list:[]}\r\n      });\r\n      const showGoods = computed(()=>{\r\n        return goods[currentOrder.value].list;\r\n      })\r\n      const init = () => {\r\n        getCategoryGoods('sales',currentCid.value).then(res=>{\r\n          goods.sales.list = res.goods.data;\r\n        })\r\n        getCategoryGoods('price',currentCid.value).then(res=>{\r\n          goods.price.list = res.goods.data;\r\n        })\r\n        getCategoryGoods('comments_count',currentCid.value).then(res=>{\r\n          goods.comments_count.list = res.goods.data;\r\n        })\r\n\r\n      }\r\n      onMounted(()=>{\r\n        getCategory().then(res=>{\r\n          categories.value = res.categories;\r\n          //console.log(res);\r\n        })\r\n        init();\r\n        //创建BetterScroll对象\r\n        bscroll = new BScroll(document.querySelector('.goodslist'),{\r\n          prodeType:3,\r\n          click:true,//是否允许点击\r\n          pullUpLoad:true//上拉加载更多默认是false\r\n        });\r\n        //触发滚动事件\r\n        bscroll.on('scroll',(position)=>{\r\n          //console.log(position);\r\n          isShowBackTop.value = (-position.y) > 300;\r\n          //console.log(isShowBackTop);\r\n        })\r\n        //上拉加载数据，触发pullingup\r\n        bscroll.on('pullingUp',()=>{\r\n          const  page = goods[currentOrder.value].page + 1;\r\n          getCategoryGoods(currentOrder.value,currentCid.value).then(res=>{\r\n            goods[currentOrder.value].list.push(...res.goods.data); //一定要把数据展开后再追加到list里面\r\n            goods[currentOrder.value].page +=1;\r\n          })\r\n          //完成上啦，等数据请求完成，更新数据展示出来\r\n          bscroll.finishPullUp();\r\n          //重新计算高度\r\n          //bscroll.refresh();\r\n          nextTick(()=>{\r\n            bscroll && bscroll.refresh();\r\n          })\r\n          console.log('当前类型：'+ currentOrder.value+'当前页数：'+page);\r\n        })\r\n      })\r\n      //排序选项卡，组件里无需手动传，只要有参数自动接收即可\r\n      const tabClick =(index)=>{\r\n        let orders = ['sales','price','comments_count'];\r\n        currentOrder.value = orders[index];\r\n        getCategoryGoods(currentOrder.value,currentCid.value).then(res=>{\r\n          goods[currentOrder.value].list = res.goods.data;\r\n          nextTick(()=>{\r\n            bscroll && bscroll.refresh();\r\n          })\r\n        })\r\n\r\n        //console.log(currentCid.value);\r\n        //console.log(currentOrder.value);\r\n      }\r\n      //通过分类得到商品\r\n      const getGoods = (cid) => {\r\n        currentCid.value = cid;\r\n        init();\r\n        /*nextTick(()=>{\r\n          bscroll && bscroll.refresh();\r\n        })*/\r\n        //console.log(currentCid.value);\r\n        //console.log(currentOrder.value);\r\n      }\r\n\r\n      //监听任何一个变量\r\n      watchEffect(()=>{\r\n        nextTick(()=>{\r\n          bscroll && bscroll.refresh();\r\n        })\r\n      });\r\n      const bTop = ()=>{\r\n        bscroll.scrollTo(0,0,1000);\r\n      }\r\n      return {\r\n        activeKey,\r\n        categories,\r\n        activeNames,\r\n        active,\r\n        tabClick,\r\n        currentOrder,\r\n        currentCid,\r\n        getGoods,\r\n        goods,\r\n        showGoods,\r\n        bscroll,\r\n        isShowBackTop,\r\n        bTop,\r\n        itemClick:(id)=>{\r\n          return router.push({path:'/detail',query:{id}});\r\n        }\r\n      }\r\n    },\r\n    components:{\r\n        NavBar,\r\n        BackTop\r\n    }\r\n    \r\n}\r\n</script>\r\n<style  scoped lang=\"scss\">\r\n#mainbox {\r\n  margin-top: 40px;\r\n  display: flex;\r\n  .ordertab {\r\n    flex: 1;\r\n    float: right;\r\n    background: red;\r\n    height: 50px;\r\n    z-index: 9;\r\n    position: fixed;\r\n    top: 40px;\r\n    right: 0;\r\n    left: 130px;\r\n  }\r\n  .leftmenu {\r\n    position: fixed;\r\n    top: 90px;\r\n    left: 0;\r\n    background: greenyellow;\r\n    width: 130px;\r\n    height: auto;\r\n  }\r\n  .goodslist {\r\n    flex: 1;\r\n    background: cornflowerblue;\r\n    position: absolute;\r\n    top: 90px;\r\n    left: 130px;\r\n    right: 0;\r\n    height: 100vh;\r\n    padding: 10px;\r\n    text-align: left !important;\r\n    .van-card__title {\r\n      font-size: 15px;\r\n      margin-top: 10px;\r\n    }\r\n    .van-card__desc {\r\n      font-size: 12px;\r\n    }\r\n\r\n  }\r\n}\r\n\r\n</style>","import {request} from './request';\r\n\r\nexport function getCategory(){\r\n    return request({\r\n        url:'/api/goods'\r\n\r\n    })\r\n}\r\nexport function getCategoryGoods(order = 'sales',cid=0,page=1){\r\n    return request({\r\n        url:'/api/goods?category_id=' + cid + '&page='+page + '&' + order + '=1'\r\n\r\n    })\r\n}","import { render } from \"./Category.vue?vue&type=template&id=7d627974&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=7d627974&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-7d627974\"\n\nexport default script"],"sourceRoot":""}