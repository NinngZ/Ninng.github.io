{"version":3,"sources":["webpack:///./src/views/order/CreateOrder.vue","webpack:///./src/views/order/CreateOrder.vue?2908","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/views/order/CreateOrder.vue?66d0"],"names":["class","alt","default","goTo","address","name","phone","province","city","county","cartList","item","index","key","goods","cover_url","title","num","price","total","button-text","handleCreateOrder","closeable","close-on-click-overlay","show","showPay","position","style","close","border","column-num","width","height","src","aliyun","wechat","setup","router","store","state","orderNo","init","loading","message","forbidClick","then","res","filter","n","is_default","length","carts","clear","push","path","timer","params","address_id","id","dispatch","console","log","type","qr_code_url","setInterval","clearInterval","query","sum","forEach","parseInt","parseFloat","components","NavBar","render","__scopeId","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error"],"mappings":"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","file":"js/chunk-80f4e856.317afb7b.js","sourcesContent":["<template>\r\n  <div class=\"create-order\">\r\n    <NavBar class=\"nav-bar\">\r\n      <template v-slot:default>订单预览</template>\r\n    </NavBar>\r\n    <div class=\"address-wrap\">\r\n      <div class=\"name\" @click=\"goTo\">\r\n        <span>{{address.name}}</span>\r\n        <span>{{address.phone}}</span>\r\n      </div>\r\n      <div class=\"address\">\r\n        {{address.province}} {{address.city}} {{address.county}} {{address.address}}\r\n      </div>\r\n      <van-icon class=\"arrow\" name=\"arrow\" />\r\n    </div>\r\n    <div class=\"good\">\r\n      <div class=\"good-item\" v-for=\"(item,index) in cartList\" :key=\"index\">\r\n        <div class=\"good-img\"><img v-lazy=\"item.goods.cover_url\" alt=\"\"></div>\r\n        <div class=\"good-desc\">\r\n          <div class=\"good-title\">\r\n            <span>{{item.goods.title}}</span>\r\n            <span>x{{item.num}}</span>\r\n          </div>\r\n          <div class=\"good-bth\">\r\n            <div class=\"price\"><small>￥</small>{{item.goods.price}}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <van-submit-bar class=\"submit-all\"\r\n                    :price=\"total * 100\"\r\n                    button-text=\"生成订单\"\r\n                    @submit=\"handleCreateOrder\">\r\n      商品金额\r\n    </van-submit-bar>\r\n    <!--弹出层组件  生成订单的时候显示，选择支付方式-->\r\n    <van-popup closeable\r\n               :close-on-click-overlay=\"false\"\r\n               v-model:show=\"showPay\"\r\n               position=\"bottom\"\r\n               :style=\"{height:'40%'}\"\r\n               @close=\"close\">\r\n\r\n      <van-grid :border=\"false\" :column-num=\"2\">\r\n        <van-grid-item>\r\n          支付宝二维码 <br>\r\n          <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n        </van-grid-item>\r\n        <van-grid-item>\r\n          微信支付二维码 <br>\r\n          <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n        </van-grid-item>\r\n      </van-grid>\r\n      <!--<div :style=\"{width:'90%',margin:'0 auto',padding:'50px 0' }\">\r\n        <van-button :style=\"{marginBottom:'10px'}\" color=\"#1989fa\" block>\r\n          支付宝\r\n        </van-button>\r\n        <van-button color=\"#4fc08d\" block>\r\n          微信支付\r\n        </van-button>\r\n      </div>-->\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NavBar from 'components/common/navbar/NavBar.vue';\r\nimport {reactive,onMounted,toRefs,computed} from \"vue\";\r\nimport {getOrderPreview,createOrder,payOrder,payOrderStatue} from \"network/order\";\r\nimport {Toast} from \"vant\";\r\nimport {useRouter,useRoute} from 'vue-router';\r\nimport {useStore} from 'vuex';\r\nexport default {\r\n  name: \"CreateOrder\",\r\n  setup(){\r\n    const router = useRouter();\r\n    const route = useRoute();\r\n    const store = useStore();\r\n    const state = reactive({\r\n      cartList: [],\r\n      address: {},\r\n      showPay:false,\r\n      orderNo:'',\r\n      aliyun:'',\r\n      wechat:''\r\n    })\r\n\r\n    const init = () => {\r\n      Toast.loading({message: '加载中...', forbidClick: true});\r\n      getOrderPreview().then(res=>{\r\n        //获取默认的地址信息\r\n        let address = res.address.filter(n => n.is_default == '1');\r\n        if (address.length == 0){\r\n          state.address = {\r\n            address: '还没有设置默认地址，请选择或者填写地址信息...'\r\n          }\r\n        }else {\r\n          state.address = address[0];\r\n        }\r\n\r\n        //获取购物车商品的信息  res.carts.goods 就是购物车里的商品信息\r\n        state.cartList = res.carts;\r\n        Toast.clear();\r\n      })\r\n    }\r\n    onMounted(() => {\r\n      init()\r\n\r\n    })\r\n    const goTo = () => {\r\n      router.push({path: '/address'})\r\n    }\r\n    let timer = null;\r\n    const handleCreateOrder = () => {\r\n      const params = {\r\n        address_id : state.address.id\r\n      }\r\n      //创建订单\r\n      createOrder(params).then(res=>{\r\n        Toast('创建订单成功');\r\n        //更新购物车红点数量\r\n        store.dispatch('updateCart');\r\n        state.showPay = true;\r\n        //res会返回订单id\r\n        state.orderNo = res.id;\r\n        console.log(state.orderNo);\r\n        //获取支付宝和微信支付的二维码\r\n        payOrder(state.orderNo,{type:'aliyun'}).then(res=>{\r\n          state.aliyun = res.qr_code_url;\r\n          state.wechat = res.qr_code_url\r\n        })\r\n        /*payOrder(state.orderNo,{type:'wechat'}).then(res=>{\r\n          state.wechat = res.qr_code_url;\r\n        })*/\r\n        //轮询查看，支付成功后跳转到订单详情界面\r\n        timer = setInterval(()=>{\r\n          payOrderStatue(state.orderNo).then(res=>{\r\n            if (res == '2'){\r\n              clearInterval(timer);\r\n              router.push({path:'/orderdetail',query:{id:state.orderNo}});\r\n            }\r\n          })\r\n        },2000)\r\n\r\n      })\r\n    }\r\n    //关闭支付弹出框后，重定向到订单详情界面\r\n    const close = () => {\r\n      clearInterval(timer);\r\n      router.push({path:'/orderdetail',query:{id:state.orderNo}})\r\n    }\r\n    const total = computed(()=>{\r\n      let sum = 0;\r\n      state.cartList.forEach(item=>{\r\n        sum += parseInt(item.num) * parseFloat(item.goods.price);\r\n      })\r\n      return sum;\r\n    })\r\n    return {\r\n      ...toRefs(state),\r\n      goTo,\r\n      handleCreateOrder,\r\n      close,\r\n      total\r\n    }\r\n  },\r\n  components:{\r\n    NavBar\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .create-order{\r\n    background: #f9f9f9;\r\n    .address-wrap{\r\n      text-align: left;\r\n      margin-bottom: 20px;\r\n      background: #fff;\r\n      position: relative;\r\n      margin-top: 44px;\r\n      font-size: 14px;\r\n      padding: 15px;\r\n      color:#222333;\r\n      .name,.adress{\r\n        margin: 10px 0;\r\n      }\r\n      .arrow{\r\n        position: absolute;\r\n        right: 10px;\r\n        top: 50%;\r\n        transform: translateY(-50%);\r\n        font-size: 20px;\r\n      }\r\n      &::before{\r\n        position: absolute;\r\n        right: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        height: 2px;\r\n        background: repeating-linear-gradient(-45deg,#ff6c6c 0,#ff6c6c  20%,transparent 0,transparent 25%,#1989fa 0);\r\n        background-size:80px;\r\n      }\r\n\r\n    }\r\n    .good{\r\n      margin-bottom: 120px;\r\n    }\r\n    .good-item{\r\n      padding: 10px;\r\n      background: #fff;\r\n      display: flex;\r\n      .good-img{\r\n        img{\r\n          width: 100px;\r\n          height: auto;\r\n        }\r\n\r\n      }\r\n\r\n    .good-desc{\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      flex: 1;\r\n      padding: 20px;\r\n      .good-title{\r\n        display: flex;\r\n        justify-content: space-between;\r\n      }\r\n        .good-btn{\r\n          display: flex;\r\n          justify-content: space-between;\r\n          .price{\r\n            font-size: 16px;\r\n            color: red;\r\n            line-height: 28px;\r\n          }\r\n          .van-icon-delete{\r\n            font-size: 20px;\r\n            margin-top: 4px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n  .pay-wrap {\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    background: #fff;\r\n    padding: 10px 50px 0;\r\n    border-top: 1px solod #e9e9e9;\r\n\r\n    > div {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      padding: 0 5%;\r\n      margin: 10px 0;\r\n      font-size: 14px;\r\n\r\n      span:nth-child(2) {\r\n        color: red;\r\n        font-size: 18px;\r\n      }\r\n    }\r\n\r\n    .pay-btn {\r\n      position: fixed;\r\n      bottom: 7px;\r\n      right: 0;\r\n      left: 0;\r\n      width: 90%;\r\n      margin: 0 auto;\r\n      }\r\n    }\r\n  }\r\n  .submit-all{\r\n    margin-bottom: 50px;\r\n    z-index: 9 !important;\r\n  }\r\n</style>","import { render } from \"./CreateOrder.vue?vue&type=template&id=b13df42c&scoped=true\"\nimport script from \"./CreateOrder.vue?vue&type=script&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=b13df42c&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-b13df42c\"\n\nexport default script","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateOrder.vue?vue&type=style&index=0&id=b13df42c&scoped=true&lang=scss\""],"sourceRoot":""}