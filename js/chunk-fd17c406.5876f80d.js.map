{"version":3,"sources":["webpack:///./node_modules/vant/es/dialog/index.js","webpack:///./src/views/order/OrderDetail.vue","webpack:///./src/views/order/OrderDetail.vue?d163","webpack:///./src/views/order/OrderDetail.vue?a13c"],"names":["class","style","default","statusString","detail","order_no","created_at","status","showPayFn","color","block","handleConfirmOrder","total","orderDetails","data","item","key","id","num","price","desc","title","goods","thumb","cover_url","show","showPay","position","border","column-num","text","width","height","src","aliyun","wechat","name","setup","route","router","state","orderNo","init","query","then","res","loading","message","forbidClick","clear","sum","forEach","parseInt","parseFloat","type","qr_code_url","timer","setInterval","clearInterval","push","path","confirm","close","components","NavBar","render","__scopeId"],"mappings":"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","file":"js/chunk-fd17c406.5876f80d.js","sourcesContent":["import { Dialog } from './function-call';\nexport default Dialog;\nexport { Dialog };","<template>\r\n  <div class=\"order-detail-box\">\r\n    <NavBar class=\"nav-bar\">\r\n      <template v-slot:default>订单详情</template>\r\n    </NavBar>\r\n    <div class=\"order-status\">\r\n      <div class=\"status-item\">\r\n        <label>订单状态:</label>\r\n        <span>{{ statusString }}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>订单编号：</label>\r\n        <span>{{ detail.order_no }}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>下单时间：</label>\r\n        <span>{{ detail.created_at }}</span>\r\n      </div>\r\n      <van-button v-if=\"detail.status == 1\" @click=\"showPayFn\" style=\"margin-bottom: 10px\" color=\"#1baeae\" block>去支付</van-button>\r\n      <van-button v-if=\"detail.status == 2\" @click=\"handleConfirmOrder\" block>确认订单</van-button>\r\n\r\n    </div>\r\n    <div class=\"order-price\">\r\n      <div class=\"price-item\">\r\n        <label>商品金额:</label>\r\n        <span>￥{{ total  }}</span>\r\n      </div>\r\n      <div class=\"price-item\">\r\n        <label>配送方式:</label>\r\n        <span>普通快递</span>\r\n      </div>\r\n    </div>\r\n    <van-card v-for=\"item in detail.orderDetails.data\" :key=\"item.id\"\r\n        :num=\"item.num\" :price=\"item.price\" desc=\"全场包邮\" :title=\"item.goods.title\" :thumb=\"item.goods.cover_url\"/>\r\n\r\n    <div style=\"width: 100%;height: 50px\">\r\n\r\n    </div>\r\n    <van-popup v-model:show=\"showPay\" position=\"bottom\" :style=\"{height:'40%'}\">\r\n      <div :style=\"{width:'90%',margin:'0 auto',padding:'50px 0'}\">\r\n        <van-grid :border=\"false\" :column-num=\"2\">\r\n          <van-grid-item text=\"支付宝\">\r\n            支付宝二维码 <br>\r\n            <van-image width=\"150\" height=\"150\" :src=\"aliyun\"></van-image>\r\n          </van-grid-item>\r\n          <van-grid-item text=\"微信支付\">\r\n            微信支付二维码 <br>\r\n            <van-image width=\"150\" height=\"150\" :src=\"wechat\"></van-image>\r\n          </van-grid-item>\r\n        </van-grid>\r\n      </div>\r\n    </van-popup>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NavBar from 'components/common/navbar/NavBar.vue';\r\nimport {useRoute,useRouter} from 'vue-router';\r\nimport {reactive,toRefs,onMounted,computed} from \"vue\";\r\nimport {Toast,Dialog} from \"vant\";\r\nimport {getOrderDetail,confirmOrder,payOrder,payOrderStatue,viewExpress} from \"network/order\";\r\n\r\nexport default {\r\n  name: \"OrderDetail\",\r\n  setup(){\r\n    const route = useRoute();\r\n    const router = useRouter();\r\n    const state = reactive({\r\n      orderNo:'',    //订单ID\r\n      detail:{\r\n        orderDetails:{\r\n          data:[]\r\n        }\r\n      },\r\n      showPay:false,\r\n      aliyun:'',\r\n      wechat:''\r\n    })\r\n    const init = () => {\r\n      const {id} = route.query;\r\n      state.orderNo = id;\r\n      getOrderDetail(id).then(res=>{\r\n        state.detail = res;\r\n      })\r\n    }\r\n    onMounted(()=>{\r\n      Toast.loading({message:'加载中...',forbidClick:true});\r\n      init();\r\n      Toast.clear();\r\n    })\r\n    //定义一个计算属性，来显示订单的状态\r\n    const statusString = computed(()=>{\r\n      let status = ['','已下单','已支付','等待发货','确认收货','已过期'];\r\n      return status[state.detail.status];\r\n    })\r\n    //定义一个计算属性，来显示订单的总价\r\n    const total = computed(()=>{\r\n      let sum = 0;\r\n      state.detail.orderDetails.data.forEach(item=>{\r\n        sum+= parseInt(item.num) * parseFloat(item.price);\r\n      })\r\n      return sum;\r\n    })\r\n    const showPayFn = () => {\r\n      state.showPay = true;\r\n      //获取支付宝和微信支付的二维码\r\n      payOrder(state.orderNo,{type:'aliyun'}).then(res=>{\r\n        state.aliyun = res.qr_code_url;\r\n        state.wechat = res.qr_code_url\r\n      })\r\n      const timer = setInterval(()=>{\r\n        payOrderStatue(state.orderNo).then(res=>{\r\n          if (res == '2'){\r\n            state.showPay = false;\r\n            clearInterval(timer);\r\n            router.push({path:'/orderdetail',query:{id:state.orderNo}});\r\n          }\r\n          /*if(!state.showPay){\r\n            clearInterval(timer);\r\n          }*/\r\n        })\r\n      },2000)\r\n    }\r\n    const handleConfirmOrder = () => {\r\n      Dialog.confirm({title:'是否确认订单'}).then(()=>{\r\n        confirmOrder(state.orderNo).then(res=>{\r\n          //if (res.status_code == 204){\r\n            Toast('确认成功');\r\n            init();\r\n\r\n        })\r\n      })\r\n    }\r\n    const close = () => {\r\n      Dialog.close();\r\n    }\r\n    return {\r\n      ...toRefs(state),\r\n      statusString,\r\n      total,\r\n      showPayFn,\r\n      handleConfirmOrder,\r\n      close\r\n    }\r\n  },\r\n  components:{\r\n    NavBar\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .order-detail-box{\r\n    text-align: left;\r\n    background: #f7f7f7;\r\n    .order-status{\r\n      background: #fff;\r\n      margin-top: 44px;\r\n      padding: 20px;\r\n      font-size: 15px;\r\n      .status-item{\r\n        margin-bottom: 10px;\r\n        label{\r\n          color: #999;\r\n        }\r\n        span{\r\n\r\n        }\r\n      }\r\n    }\r\n    .order-price{\r\n      text-align: left;\r\n      background: #f7f7f7;\r\n      padding: 10px 20px;\r\n      .price-item{\r\n        margin-top: 20px;\r\n      }\r\n    }\r\n  }\r\n</style>","import { render } from \"./OrderDetail.vue?vue&type=template&id=449474dc&scoped=true\"\nimport script from \"./OrderDetail.vue?vue&type=script&lang=js\"\nexport * from \"./OrderDetail.vue?vue&type=script&lang=js\"\n\nimport \"./OrderDetail.vue?vue&type=style&index=0&id=449474dc&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-449474dc\"\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OrderDetail.vue?vue&type=style&index=0&id=449474dc&scoped=true&lang=scss\""],"sourceRoot":""}